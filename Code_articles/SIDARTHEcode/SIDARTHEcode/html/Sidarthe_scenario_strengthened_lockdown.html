<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>Sidarthe_scenario_strengthened_lockdown</title>
<meta name="generator" content="MATLAB 23.2">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2024-02-09">
<meta name="DC.source" content="Sidarthe_scenario_strengthened_lockdown.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<pre class="codeinput">
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">% MATLAB Code for epidemic simulations with the SIDARTHE model in the work</span>
<span class="comment">%</span>
<span class="comment">% Modelling the COVID-19 epidemic and implementation of population-wide interventions in Italy</span>
<span class="comment">% by Giulia Giordano, Franco Blanchini, Raffaele Bruno, Patrizio Colaneri, Alessandro Di Filippo, Angela Di Matteo, Marta Colaneri</span>
<span class="comment">%</span>
<span class="comment">% Giulia Giordano, April 5, 2020</span>
<span class="comment">% Contact: giulia.giordano@unitn.it</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">% DATA</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

<span class="comment">% Italian population</span>
popolazione=60e6;

<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">% PARAMETERS</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

<span class="comment">% Simulation horizon: CAN BE MODIFIED AT ONE'S WILL</span>
Orizzonte = 350;

<span class="comment">% Plot yes/no: SET TO 1 IF PDF FIGURES MUST BE GENERATED, 0 OTHERWISE</span>
plotPDF = 0;

<span class="comment">% Time-step for Euler discretisation of the continuous-time system</span>
step=0.01;

<span class="comment">% Transmission rate due to contacts with UNDETECTED asymptomatic infected</span>
alfa=0.57;
<span class="comment">% Transmission rate due to contacts with DETECTED asymptomatic infected</span>
beta=0.0114;
<span class="comment">% Transmission rate due to contacts with UNDETECTED symptomatic infected</span>
gamma=0.456;
<span class="comment">% Transmission rate due to contacts with DETECTED symptomatic infected</span>
delta=0.0114;

<span class="comment">% Detection rate for ASYMPTOMATIC</span>
epsilon=0.171;
<span class="comment">% Detection rate for SYMPTOMATIC</span>
theta=0.3705;

<span class="comment">% Worsening rate: UNDETECTED asymptomatic infected becomes symptomatic</span>
zeta=0.1254;
<span class="comment">% Worsening rate: DETECTED asymptomatic infected becomes symptomatic</span>
eta=0.1254;

<span class="comment">% Worsening rate: UNDETECTED symptomatic infected develop life-threatening</span>
<span class="comment">% symptoms</span>
mu=0.0171;
<span class="comment">% Worsening rate: DETECTED symptomatic infected develop life-threatening</span>
<span class="comment">% symptoms</span>
nu=0.0274;

<span class="comment">% Mortality rate for infected with life-threatening symptoms</span>
tau=0.01;

<span class="comment">% Recovery rate for undetected asymptomatic infected</span>
lambda=0.0342;
<span class="comment">% Recovery rate for detected asymptomatic infected</span>
rho=0.0342;
<span class="comment">% Recovery rate for undetected symptomatic infected</span>
kappa=0.0171;
<span class="comment">% Recovery rate for detected symptomatic infected</span>
xi=0.0171;
<span class="comment">% Recovery rate for life-threatened symptomatic infected</span>
sigma=0.0171;

<span class="comment">% Rate of loss of immunity</span>
ki=0;

<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">% DEFINITIONS</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

<span class="comment">% Parameters</span>
r1=epsilon+zeta+lambda;
r2=eta+rho;
r3=theta+mu+kappa;
r4=nu+xi;
r5=sigma+tau;

<span class="comment">% Initial R0</span>
R0_iniziale=alfa/r1+beta*epsilon/(r1*r2)+gamma*zeta/(r1*r3)+delta*eta*epsilon/(r1*r2*r4)+delta*zeta*theta/(r1*r3*r4)

<span class="comment">% Time horizon</span>
t=1:step:Orizzonte;

<span class="comment">% Vectors for time evolution of variables</span>
S=zeros(1,length(t));
I=zeros(1,length(t));
D=zeros(1,length(t));
A=zeros(1,length(t));
R=zeros(1,length(t));
T=zeros(1,length(t));
H=zeros(1,length(t));
H_diagnosticati=zeros(1,length(t)); <span class="comment">% DIAGNOSED recovered only!</span>
E=zeros(1,length(t));

<span class="comment">% Vectors for time evolution of actual/perceived Case Fatality Rate</span>
M=zeros(1,length(t));
P=zeros(1,length(t));

<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">% INITIAL CONDITIONS</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

I(1)=200/popolazione;
D(1)=20/popolazione;
A(1)=1/popolazione;
R(1)=2/popolazione;
T(1)=0.00;
H(1)=0.00;
E(1)=0.00;
S(1)=1-I(1)-D(1)-A(1)-R(1)-T(1)-H(1)-E(1);

H_diagnosticati(1) = 0.00; <span class="comment">% DIAGNOSED recovered only</span>
Infetti_reali(1)=I(1)+D(1)+A(1)+R(1)+T(1); <span class="comment">% Actual currently infected</span>

M(1)=0;
P(1)=0;

<span class="comment">% Whole state vector</span>
x=[S(1);I(1);D(1);A(1);R(1);T(1);H(1);E(1);H_diagnosticati(1);Infetti_reali(1)];

<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">% SIMULATION</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

<span class="comment">% "Control" binary variables to compute the new R0 every time a policy has</span>
<span class="comment">% changed the parameters</span>
plottato = 0;
plottato1 = 0;
plottato_bis = 0;
plottato_tris = 0;
plottato_quat = 0;
plottato_fin = 0;

<span class="keyword">for</span> i=2:length(t)

    <span class="keyword">if</span> (i&gt;4/step) <span class="comment">% Basic social distancing (awareness, schools closed)</span>
        alfa=0.4218;
        gamma=0.285;
        beta = 0.0057;
        delta=0.0057;
        <span class="keyword">if</span> plottato == 0 <span class="comment">% Compute the new R0</span>
            r1=epsilon+zeta+lambda;
            r2=eta+rho;
            r3=theta+mu+kappa;
            r4=nu+xi;
            r5=sigma+tau;
            R0_primemisure=alfa/r1+beta*epsilon/(r1*r2)+gamma*zeta/(r1*r3)+delta*eta*epsilon/(r1*r2*r4)+delta*zeta*theta/(r1*r3*r4)
            plottato = 1;
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="keyword">if</span> (i&gt;12/step)
        <span class="comment">% Screening limited to / focused on symptomatic subjects</span>
        epsilon=0.1425;
        <span class="keyword">if</span> plottato1 == 0
            r1=epsilon+zeta+lambda;
            r2=eta+rho;
            r3=theta+mu+kappa;
            r4=nu+xi;
            r5=sigma+tau;
            R0_primemisureeps=alfa/r1+beta*epsilon/(r1*r2)+gamma*zeta/(r1*r3)+delta*eta*epsilon/(r1*r2*r4)+delta*zeta*theta/(r1*r3*r4)
            plottato1 = 1;
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="keyword">if</span> (i&gt;22/step) <span class="comment">% Social distancing: lockdown, mild effect</span>

        alfa=0.36;
        beta=0.005;
        gamma=0.2;
        delta=0.005;

        mu = 0.008;
        nu = 0.015;

        zeta=0.034;
        eta=0.034;

        lambda=0.08;
        rho=0.0171;
        kappa=0.0171;
        xi=0.0171;
        sigma=0.0171;

        <span class="keyword">if</span> plottato_bis == 0 <span class="comment">% Compute the new R0</span>
            r1=epsilon+zeta+lambda;
            r2=eta+rho;
            r3=theta+mu+kappa;
            r4=nu+xi;
            r5=sigma+tau;
            R0_secondemisure=(alfa*r2*r3*r4+epsilon*beta*r3*r4+gamma*zeta*r2*r4+delta*eta*epsilon*r3+delta*zeta*theta*r2)/(r1*r2*r3*r4)
            plottato_bis = 1;
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="keyword">if</span> (i&gt;28/step) <span class="comment">% Social distancing: lockdown, strong effect</span>

        alfa=0.21;
        gamma=0.11;

        <span class="keyword">if</span> plottato_tris == 0 <span class="comment">% Compute the new R0</span>
            r1=epsilon+zeta+lambda;
            r2=eta+rho;
            r3=theta+mu+kappa;
            r4=nu+xi;
            r5=sigma+tau;
            R0_terzemisure=(alfa*r2*r3*r4+epsilon*beta*r3*r4+gamma*zeta*r2*r4+delta*eta*epsilon*r3+delta*zeta*theta*r2)/(r1*r2*r3*r4)
            plottato_tris = 1;
        <span class="keyword">end</span>
    <span class="keyword">end</span>


    <span class="keyword">if</span> (i&gt;38/step) <span class="comment">% Broader diagnosis campaign</span>

        epsilon = 0.2;
        rho=0.02;
        kappa=0.02;
        xi=0.02;
        sigma=0.01;

        zeta=0.025;
        eta=0.025;

        <span class="keyword">if</span> plottato_quat == 0 <span class="comment">% Compute the new R0</span>
            r1=epsilon+zeta+lambda;
            r2=eta+rho;
            r3=theta+mu+kappa;
            r4=nu+xi;
            r5=sigma+tau;
            R0_quartemisure=(alfa*r2*r3*r4+epsilon*beta*r3*r4+gamma*zeta*r2*r4+delta*eta*epsilon*r3+delta*zeta*theta*r2)/(r1*r2*r3*r4)
            plottato_quat = 1;
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% OUTLOOK: to EXPLORE POSSIBLE SCENARIOS,</span>
    <span class="comment">% change the parameters (after 50 days)</span>
    <span class="keyword">if</span> (i&gt;50/step)

        alfa=0.2100*0.5;
        beta=0.0050*1;
        gamma=0.1100*1;
        delta=0.0050*1;

        epsilon= 0.2000*1;
        theta = 0.3705*1;

        zeta = 0.0250*1;
        eta  = 0.0250*1;

        mu  = 0.008*1;
        nu   = 0.0150*1;

        tau   = 0.0100*1;

        lambda   = 0.0800*1;
        rho  = 0.0200*1;
        kappa  = 0.0200*1;
        xi  = 0.0200*1;
        sigma = 0.0100*1;

        ki=0;

        <span class="keyword">if</span> plottato_fin == 0 <span class="comment">% Compute the new R0</span>
            r1=epsilon+zeta+lambda;
            r2=eta+rho;
            r3=theta+mu+kappa;
            r4=nu+xi;
            r5=sigma+tau;
            R0_final=(alfa*r2*r3*r4+epsilon*beta*r3*r4+gamma*zeta*r2*r4+delta*eta*epsilon*r3+delta*zeta*theta*r2)/(r1*r2*r3*r4)
            plottato_fin = 1;
        <span class="keyword">end</span>

    <span class="keyword">end</span>

    <span class="comment">% Compute the system evolution</span>

    B=[-alfa*x(2)-beta*x(3)-gamma*x(4)-delta*x(5) 0 0 0 0 0 ki 0 0 0;
        alfa*x(2)+beta*x(3)+gamma*x(4)+delta*x(5) -(epsilon+zeta+lambda) 0 0 0 0 0 0 0 0;
        0 epsilon  -(eta+rho) 0 0 0 0 0 0 0;
        0 zeta 0 -(theta+mu+kappa) 0 0 0 0 0 0;
        0 0 eta theta -(nu+xi) 0 0 0 0 0;
        0 0 0 mu nu  -(sigma+tau) 0 0 0 0;
        0 lambda rho kappa xi sigma -ki 0 0 0;
        0 0 0 0 0 tau 0 0 0 0;
        0 0 rho 0 xi sigma 0 0 0 0;
        alfa*x(2)+beta*x(3)+gamma*x(4)+delta*x(5) 0 0 0 0 0 0 0 0 0];
    x=x+B*x*step;

    <span class="comment">% Update variables</span>

    S(i)=x(1);
    I(i)=x(2);
    D(i)=x(3);
    A(i)=x(4);
    R(i)=x(5);
    T(i)=x(6);
    H(i)=x(7);
    E(i)=x(8);

    H_diagnosticati(i)=x(9);
    Infetti_reali(i)=x(10);

    <span class="comment">% Update Case Fatality Rate</span>

    M(i)=E(i)/(S(1)-S(i));
    P(i)=E(i)/((epsilon*r3+(theta+mu)*zeta)*(I(1)+S(1)-I(i)-S(i))/(r1*r3)+(theta+mu)*(A(1)-A(i))/r3);

<span class="keyword">end</span>

<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">% FINAL VALUES</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

<span class="comment">% Variables</span>
Sbar=S(length(t));
Ibar=I(length(t));
Dbar=D(length(t));
Abar=A(length(t));
Rbar=R(length(t));
Tbar=T(length(t));
Hbar=H(length(t));
Ebar=E(length(t));

<span class="comment">% Case fatality rate</span>
Mbar=M(length(t));
Pbar=P(length(t));

<span class="comment">% Case fatality rate from formulas</span>
Mbar1=Ebar/(S(1)-Sbar);
Pbar1=Ebar/((epsilon*r3+(theta+mu)*zeta)*(I(1)+S(1)-Sbar-Ibar)/(r1*r3)+(theta+mu)*(A(1)-Abar)/r3);

<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">% FIGURES</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

figure
plot(t,Infetti_reali,<span class="string">'b'</span>,t,I+D+A+R+T,<span class="string">'r'</span>,t,H,<span class="string">'g'</span>,t,E,<span class="string">'k'</span>)
hold <span class="string">on</span>
plot(t,D+R+T+E+H_diagnosticati,<span class="string">'--b'</span>,t,D+R+T,<span class="string">'--r'</span>,t,H_diagnosticati,<span class="string">'--g'</span>)
xlim([t(1) t(end)])
ylim([0 0.015])
<span class="comment">%title('Actual vs. Diagnosed Epidemic Evolution')</span>
xlabel(<span class="string">'Time (days)'</span>)
ylabel(<span class="string">'Cases (fraction of the population)'</span>)
legend({<span class="string">'Cumulative Infected'</span>,<span class="string">'Current Total Infected'</span>, <span class="string">'Recovered'</span>, <span class="string">'Deaths'</span>,<span class="string">'Diagnosed Cumulative Infected'</span>,<span class="string">'Diagnosed Current Total Infected'</span>, <span class="string">'Diagnosed Recovered'</span>},<span class="string">'Location'</span>,<span class="string">'east'</span>)
grid

<span class="keyword">if</span> plotPDF==1
    set(gcf, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
    set(gcf, <span class="string">'PaperPosition'</span>, [0 0 24 16]);
    set(gcf, <span class="string">'PaperSize'</span>, [24 16]); <span class="comment">% dimension on x axis and y axis resp.</span>
    print(gcf,<span class="string">'-dpdf'</span>, [<span class="string">'PanoramicaEpidemiaRealevsPercepita.pdf'</span>])
<span class="keyword">end</span>
<span class="comment">%</span>

figure
plot(t,I,<span class="string">'b'</span>,t,D,<span class="string">'c'</span>,t,A,<span class="string">'g'</span>,t,R,<span class="string">'m'</span>,t,T,<span class="string">'r'</span>)
xlim([t(1) t(end)])
ylim([0 1.1e-3])
<span class="comment">%title('Infected, different stages, Diagnosed vs. Non Diagnosed')</span>
xlabel(<span class="string">'Time (days)'</span>)
ylabel(<span class="string">'Cases (fraction of the population)'</span>)
legend({<span class="string">'Infected ND AS'</span>, <span class="string">'Infected D AS'</span>, <span class="string">'Infected ND S'</span>, <span class="string">'Infected D S'</span>, <span class="string">'Infected D IC'</span>},<span class="string">'Location'</span>,<span class="string">'northeast'</span>)
grid

<span class="keyword">if</span> plotPDF==1
    set(gcf, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
    set(gcf, <span class="string">'PaperPosition'</span>, [0 0 24 16]);
    set(gcf, <span class="string">'PaperSize'</span>, [24 16]); <span class="comment">% dimension on x axis and y axis resp.</span>
    print(gcf,<span class="string">'-dpdf'</span>, [<span class="string">'SuddivisioneInfetti.pdf'</span>])
<span class="keyword">end</span>
</pre>
<pre class="codeoutput">
R0_iniziale =

    2.3815


R0_primemisure =

    1.6580


R0_primemisureeps =

    1.8015


R0_secondemisure =

    1.6018


R0_terzemisure =

    0.9868


R0_quartemisure =

    0.8469


R0_final =

    0.5027

</pre>
<img vspace="5" hspace="5" src="Sidarthe_scenario_strengthened_lockdown_01.png" alt=""> <img vspace="5" hspace="5" src="Sidarthe_scenario_strengthened_lockdown_02.png" alt=""> <p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2023b</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% MATLAB Code for epidemic simulations with the SIDARTHE model in the work
%
% Modelling the COVID-19 epidemic and implementation of population-wide interventions in Italy
% by Giulia Giordano, Franco Blanchini, Raffaele Bruno, Patrizio Colaneri, Alessandro Di Filippo, Angela Di Matteo, Marta Colaneri
% 
% Giulia Giordano, April 5, 2020
% Contact: giulia.giordano@unitn.it
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

clear all
close all
clc

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DATA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Italian population
popolazione=60e6;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PARAMETERS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Simulation horizon: CAN BE MODIFIED AT ONE'S WILL
Orizzonte = 350;

% Plot yes/no: SET TO 1 IF PDF FIGURES MUST BE GENERATED, 0 OTHERWISE
plotPDF = 0;

% Time-step for Euler discretisation of the continuous-time system
step=0.01;

% Transmission rate due to contacts with UNDETECTED asymptomatic infected
alfa=0.57;
% Transmission rate due to contacts with DETECTED asymptomatic infected
beta=0.0114;
% Transmission rate due to contacts with UNDETECTED symptomatic infected
gamma=0.456;
% Transmission rate due to contacts with DETECTED symptomatic infected
delta=0.0114;

% Detection rate for ASYMPTOMATIC
epsilon=0.171;
% Detection rate for SYMPTOMATIC
theta=0.3705;

% Worsening rate: UNDETECTED asymptomatic infected becomes symptomatic
zeta=0.1254;
% Worsening rate: DETECTED asymptomatic infected becomes symptomatic
eta=0.1254;

% Worsening rate: UNDETECTED symptomatic infected develop life-threatening
% symptoms
mu=0.0171;
% Worsening rate: DETECTED symptomatic infected develop life-threatening
% symptoms
nu=0.0274;

% Mortality rate for infected with life-threatening symptoms
tau=0.01;

% Recovery rate for undetected asymptomatic infected
lambda=0.0342;
% Recovery rate for detected asymptomatic infected
rho=0.0342;
% Recovery rate for undetected symptomatic infected
kappa=0.0171;
% Recovery rate for detected symptomatic infected
xi=0.0171;
% Recovery rate for life-threatened symptomatic infected
sigma=0.0171;

% Rate of loss of immunity
ki=0;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DEFINITIONS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Parameters
r1=epsilon+zeta+lambda;
r2=eta+rho;
r3=theta+mu+kappa;
r4=nu+xi;
r5=sigma+tau;

% Initial R0
R0_iniziale=alfa/r1+beta*epsilon/(r1*r2)+gamma*zeta/(r1*r3)+delta*eta*epsilon/(r1*r2*r4)+delta*zeta*theta/(r1*r3*r4)

% Time horizon
t=1:step:Orizzonte;

% Vectors for time evolution of variables
S=zeros(1,length(t));
I=zeros(1,length(t));
D=zeros(1,length(t));
A=zeros(1,length(t));
R=zeros(1,length(t));
T=zeros(1,length(t));
H=zeros(1,length(t));
H_diagnosticati=zeros(1,length(t)); % DIAGNOSED recovered only!
E=zeros(1,length(t));

% Vectors for time evolution of actual/perceived Case Fatality Rate
M=zeros(1,length(t));
P=zeros(1,length(t));

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% INITIAL CONDITIONS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

I(1)=200/popolazione;
D(1)=20/popolazione;
A(1)=1/popolazione;
R(1)=2/popolazione;
T(1)=0.00;
H(1)=0.00;
E(1)=0.00;
S(1)=1-I(1)-D(1)-A(1)-R(1)-T(1)-H(1)-E(1);

H_diagnosticati(1) = 0.00; % DIAGNOSED recovered only
Infetti_reali(1)=I(1)+D(1)+A(1)+R(1)+T(1); % Actual currently infected

M(1)=0;
P(1)=0;

% Whole state vector
x=[S(1);I(1);D(1);A(1);R(1);T(1);H(1);E(1);H_diagnosticati(1);Infetti_reali(1)];

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SIMULATION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% "Control" binary variables to compute the new R0 every time a policy has
% changed the parameters
plottato = 0;
plottato1 = 0;
plottato_bis = 0;
plottato_tris = 0;
plottato_quat = 0;
plottato_fin = 0;

for i=2:length(t)
    
    if (i>4/step) % Basic social distancing (awareness, schools closed)
        alfa=0.4218;
        gamma=0.285;
        beta = 0.0057;
        delta=0.0057;
        if plottato == 0 % Compute the new R0
            r1=epsilon+zeta+lambda;
            r2=eta+rho;
            r3=theta+mu+kappa;
            r4=nu+xi;
            r5=sigma+tau;
            R0_primemisure=alfa/r1+beta*epsilon/(r1*r2)+gamma*zeta/(r1*r3)+delta*eta*epsilon/(r1*r2*r4)+delta*zeta*theta/(r1*r3*r4)
            plottato = 1;
        end
    end
    
    if (i>12/step)
        % Screening limited to / focused on symptomatic subjects
        epsilon=0.1425;
        if plottato1 == 0
            r1=epsilon+zeta+lambda;
            r2=eta+rho;
            r3=theta+mu+kappa;
            r4=nu+xi;
            r5=sigma+tau;
            R0_primemisureeps=alfa/r1+beta*epsilon/(r1*r2)+gamma*zeta/(r1*r3)+delta*eta*epsilon/(r1*r2*r4)+delta*zeta*theta/(r1*r3*r4)
            plottato1 = 1;
        end
    end
    
    if (i>22/step) % Social distancing: lockdown, mild effect
        
        alfa=0.36;
        beta=0.005;
        gamma=0.2;
        delta=0.005;
        
        mu = 0.008;
        nu = 0.015;
        
        zeta=0.034;
        eta=0.034;
        
        lambda=0.08;
        rho=0.0171;
        kappa=0.0171;
        xi=0.0171;
        sigma=0.0171;
        
        if plottato_bis == 0 % Compute the new R0
            r1=epsilon+zeta+lambda;
            r2=eta+rho;
            r3=theta+mu+kappa;
            r4=nu+xi;
            r5=sigma+tau;
            R0_secondemisure=(alfa*r2*r3*r4+epsilon*beta*r3*r4+gamma*zeta*r2*r4+delta*eta*epsilon*r3+delta*zeta*theta*r2)/(r1*r2*r3*r4)
            plottato_bis = 1;
        end
    end
    
    if (i>28/step) % Social distancing: lockdown, strong effect
        
        alfa=0.21;
        gamma=0.11;
        
        if plottato_tris == 0 % Compute the new R0
            r1=epsilon+zeta+lambda;
            r2=eta+rho;
            r3=theta+mu+kappa;
            r4=nu+xi;
            r5=sigma+tau;
            R0_terzemisure=(alfa*r2*r3*r4+epsilon*beta*r3*r4+gamma*zeta*r2*r4+delta*eta*epsilon*r3+delta*zeta*theta*r2)/(r1*r2*r3*r4)
            plottato_tris = 1;
        end
    end
    
    
    if (i>38/step) % Broader diagnosis campaign
        
        epsilon = 0.2;
        rho=0.02;
        kappa=0.02;
        xi=0.02;
        sigma=0.01;
        
        zeta=0.025;
        eta=0.025;
        
        if plottato_quat == 0 % Compute the new R0
            r1=epsilon+zeta+lambda;
            r2=eta+rho;
            r3=theta+mu+kappa;
            r4=nu+xi;
            r5=sigma+tau;
            R0_quartemisure=(alfa*r2*r3*r4+epsilon*beta*r3*r4+gamma*zeta*r2*r4+delta*eta*epsilon*r3+delta*zeta*theta*r2)/(r1*r2*r3*r4)
            plottato_quat = 1;
        end
    end
    
    % OUTLOOK: to EXPLORE POSSIBLE SCENARIOS,
    % change the parameters (after 50 days)
    if (i>50/step)
        
        alfa=0.2100*0.5;
        beta=0.0050*1;
        gamma=0.1100*1;
        delta=0.0050*1;
        
        epsilon= 0.2000*1;
        theta = 0.3705*1;
        
        zeta = 0.0250*1;
        eta  = 0.0250*1;
        
        mu  = 0.008*1;
        nu   = 0.0150*1;
        
        tau   = 0.0100*1;
        
        lambda   = 0.0800*1;
        rho  = 0.0200*1;
        kappa  = 0.0200*1;
        xi  = 0.0200*1;
        sigma = 0.0100*1;
        
        ki=0;
        
        if plottato_fin == 0 % Compute the new R0
            r1=epsilon+zeta+lambda;
            r2=eta+rho;
            r3=theta+mu+kappa;
            r4=nu+xi;
            r5=sigma+tau;
            R0_final=(alfa*r2*r3*r4+epsilon*beta*r3*r4+gamma*zeta*r2*r4+delta*eta*epsilon*r3+delta*zeta*theta*r2)/(r1*r2*r3*r4)
            plottato_fin = 1;
        end
        
    end
    
    % Compute the system evolution
    
    B=[-alfa*x(2)-beta*x(3)-gamma*x(4)-delta*x(5) 0 0 0 0 0 ki 0 0 0;
        alfa*x(2)+beta*x(3)+gamma*x(4)+delta*x(5) -(epsilon+zeta+lambda) 0 0 0 0 0 0 0 0;
        0 epsilon  -(eta+rho) 0 0 0 0 0 0 0;
        0 zeta 0 -(theta+mu+kappa) 0 0 0 0 0 0;
        0 0 eta theta -(nu+xi) 0 0 0 0 0;
        0 0 0 mu nu  -(sigma+tau) 0 0 0 0;
        0 lambda rho kappa xi sigma -ki 0 0 0;
        0 0 0 0 0 tau 0 0 0 0;
        0 0 rho 0 xi sigma 0 0 0 0;
        alfa*x(2)+beta*x(3)+gamma*x(4)+delta*x(5) 0 0 0 0 0 0 0 0 0];
    x=x+B*x*step;
    
    % Update variables
    
    S(i)=x(1);
    I(i)=x(2);
    D(i)=x(3);
    A(i)=x(4);
    R(i)=x(5);
    T(i)=x(6);
    H(i)=x(7);
    E(i)=x(8);
    
    H_diagnosticati(i)=x(9);
    Infetti_reali(i)=x(10);
    
    % Update Case Fatality Rate
    
    M(i)=E(i)/(S(1)-S(i));
    P(i)=E(i)/((epsilon*r3+(theta+mu)*zeta)*(I(1)+S(1)-I(i)-S(i))/(r1*r3)+(theta+mu)*(A(1)-A(i))/r3);
    
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% FINAL VALUES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Variables
Sbar=S(length(t));
Ibar=I(length(t));
Dbar=D(length(t));
Abar=A(length(t));
Rbar=R(length(t));
Tbar=T(length(t));
Hbar=H(length(t));
Ebar=E(length(t));

% Case fatality rate
Mbar=M(length(t));
Pbar=P(length(t));

% Case fatality rate from formulas
Mbar1=Ebar/(S(1)-Sbar);
Pbar1=Ebar/((epsilon*r3+(theta+mu)*zeta)*(I(1)+S(1)-Sbar-Ibar)/(r1*r3)+(theta+mu)*(A(1)-Abar)/r3);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% FIGURES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

figure
plot(t,Infetti_reali,'b',t,I+D+A+R+T,'r',t,H,'g',t,E,'k')
hold on
plot(t,D+R+T+E+H_diagnosticati,'REPLACE_WITH_DASH_DASHb',t,D+R+T,'REPLACE_WITH_DASH_DASHr',t,H_diagnosticati,'REPLACE_WITH_DASH_DASHg')
xlim([t(1) t(end)])
ylim([0 0.015])
%title('Actual vs. Diagnosed Epidemic Evolution')
xlabel('Time (days)')
ylabel('Cases (fraction of the population)')
legend({'Cumulative Infected','Current Total Infected', 'Recovered', 'Deaths','Diagnosed Cumulative Infected','Diagnosed Current Total Infected', 'Diagnosed Recovered'},'Location','east')
grid

if plotPDF==1
    set(gcf, 'PaperUnits', 'centimeters');
    set(gcf, 'PaperPosition', [0 0 24 16]);
    set(gcf, 'PaperSize', [24 16]); % dimension on x axis and y axis resp.
    print(gcf,'-dpdf', ['PanoramicaEpidemiaRealevsPercepita.pdf'])
end
%

figure
plot(t,I,'b',t,D,'c',t,A,'g',t,R,'m',t,T,'r')
xlim([t(1) t(end)])
ylim([0 1.1e-3])
%title('Infected, different stages, Diagnosed vs. Non Diagnosed')
xlabel('Time (days)')
ylabel('Cases (fraction of the population)')
legend({'Infected ND AS', 'Infected D AS', 'Infected ND S', 'Infected D S', 'Infected D IC'},'Location','northeast')
grid

if plotPDF==1
    set(gcf, 'PaperUnits', 'centimeters');
    set(gcf, 'PaperPosition', [0 0 24 16]);
    set(gcf, 'PaperSize', [24 16]); % dimension on x axis and y axis resp.
    print(gcf,'-dpdf', ['SuddivisioneInfetti.pdf'])
end
##### SOURCE END #####
-->
</body>
</html>
